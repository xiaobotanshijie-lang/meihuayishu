<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>梅花易数 - 在线起卦</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&display=swap');
        body { font-family: 'Noto Serif SC', serif; background-color: #f4f1ea; color: #333; }
        .gua-line { height: 8px; width: 100px; margin: 4px auto; border-radius: 2px; }
        .yang { background-color: #222; }
        .yin { background-color: #222; position: relative; width: 100px; background: transparent !important; }
        .yin::before, .yin::after { content: ''; position: absolute; height: 100%; width: 42%; background: #222; }
        .yin::before { left: 0; }
        .yin::after { right: 0; }
        .active-yao { background-color: #c0392b !important; } /* 动爻标记为红色 */
        .yin.active-yao::before, .yin.active-yao::after { background: #c0392b; }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-2xl mx-auto bg-white p-6 rounded-lg shadow-xl border-t-4 border-black">
        <h1 class="text-3xl font-bold text-center mb-8">梅花易数</h1>
        
        <div class="space-y-4">
            <div>
                <label class="block text-sm font-medium mb-1">所问何事</label>
                <input id="question" type="text" placeholder="例如：今日财运如何？" class="w-full p-2 border border-gray-300 rounded">
            </div>
            <div class="grid grid-cols-3 gap-4">
                <div>
                    <label class="block text-sm font-medium mb-1">数字一 (上卦)</label>
                    <input id="num1" type="number" class="w-full p-2 border border-gray-300 rounded" placeholder="如: 78">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">数字二 (下卦)</label>
                    <input id="num2" type="number" class="w-full p-2 border border-gray-300 rounded" placeholder="如: 89">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">数字三 (动爻)</label>
                    <input id="num3" type="number" class="w-full p-2 border border-gray-300 rounded" placeholder="如: 91">
                </div>
            </div>
            <button onclick="calculate()" class="w-full bg-black text-white py-3 rounded hover:bg-gray-800 transition">立即起卦</button>
        </div>

        <hr class="my-8">

        <div id="result" class="hidden space-y-8">
            <div class="grid grid-cols-2 gap-8 text-center">
                <div>
                    <h2 class="text-xl font-bold mb-4">主卦</h2>
                    <div id="main-gua-graph" class="mb-4"></div>
                    <p id="main-gua-name" class="text-lg font-bold"></p>
                </div>
                <div>
                    <h2 class="text-xl font-bold mb-4">变卦（支卦）</h2>
                    <div id="change-gua-graph" class="mb-4"></div>
                    <p id="change-gua-name" class="text-lg font-bold"></p>
                </div>
            </div>
            <div class="bg-gray-50 p-4 rounded border-l-4 border-gray-400">
                <p id="analysis-text" class="text-sm leading-relaxed text-gray-700"></p>
            </div>
        </div>
    </div>

    <script>
        // 八卦基础数据：1乾, 2兑, 3离, 4震, 5巽, 6坎, 7艮, 8坤
        const bagua = {
            1: { name: "乾", symbol: [1, 1, 1] },
            2: { name: "兑", symbol: [0, 1, 1] },
            3: { name: "离", symbol: [1, 0, 1] },
            4: { name: "震", symbol: [0, 0, 1] },
            5: { name: "巽", symbol: [1, 1, 0] },
            6: { name: "坎", symbol: [0, 1, 0] },
            7: { name: "艮", symbol: [1, 0, 0] },
            8: { name: "坤", symbol: [0, 0, 0] }
        };

        // 简化的64卦名（示例，实际开发可扩充完整卦辞）
        const getGuaName = (up, down) => {
            const names = { "61": "水天需", "65": "水风井", "11": "乾为天", "88": "坤为地" }; // 举例
            return names[`${up}${down}`] || `${bagua[up].name}${bagua[down].name}卦`;
        };

        function drawGua(containerId, upNum, downNum, activeYao = -1) {
            const container = document.getElementById(containerId);
            container.innerHTML = "";
            // 六爻从上往下画（但在易经中，初爻在下，这里为了对应逻辑进行排列）
            const lines = [...bagua[upNum].symbol, ...bagua[downNum].symbol].reverse();
            
            lines.forEach((type, index) => {
                const realIndex = 6 - index; // 转换为初爻到六爻
                const div = document.createElement('div');
                div.className = `gua-line ${type === 1 ? 'yang' : 'yin'} ${realIndex === activeYao ? 'active-yao' : ''}`;
                container.appendChild(div);
            });
        }

        function calculate() {
            const n1 = parseInt(document.getElementById('num1').value);
            const n2 = parseInt(document.getElementById('num2').value);
            const n3 = parseInt(document.getElementById('num3').value);

            if (!n1 || !n2 || !n3) return alert("请输入完整数字");

            // 1. 计算上下卦和动爻
            const up = n1 % 8 === 0 ? 8 : n1 % 8;
            const down = n2 % 8 === 0 ? 8 : n2 % 8;
            const movingYao = n3 % 6 === 0 ? 6 : n3 % 6;

            // 2. 计算变卦
            let allYaos = [...bagua[up].symbol, ...bagua[down].symbol]; // 注意：数组顺序通常需对应初爻到六爻
            // 在梅花易数逻辑中，上卦是前三个，下卦是后三个。我们模拟翻转动爻：
            // 动爻在第n位（从下往上数），对应数组索引：
            const targetIdx = 6 - movingYao; 
            let changeYaos = [...allYaos];
            changeYaos[targetIdx] = changeYaos[targetIdx] === 1 ? 0 : 1;

            // 简单识别变卦的上下卦
            // (此处逻辑简化，实际需根据数组重新匹配八卦ID)
            
            // 3. 渲染
            document.getElementById('result').classList.remove('hidden');
            drawGua('main-gua-graph', up, down, movingYao);
            drawGua('change-gua-graph', up, down); // 变卦绘图逻辑可进一步细化

            document.getElementById('main-gua-name').innerText = getGuaName(up, down);
            document.getElementById('change-gua-name').innerText = `动在${movingYao}爻`;
            
            document.getElementById('analysis-text').innerText = 
                `卦象分析：上卦为${bagua[up].name}，下卦为${bagua[down].name}。动爻为第${movingYao}爻。主卦代表当前状态，变卦代表事情最终的发展结果。建议结合《易经》${getGuaName(up, down)}卦辞进行深度推演。`;
        }
    </script>
</body>
</html>
